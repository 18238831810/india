<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cf.crs.mapper.AccountBalanceMapper">

   <insert id="updateAddBalance">
       INSERT INTO `u_account_balance`(`uid`,`amount`,`update_time`,`consume_count`,`order_count`,`phone`)
       VALUES (#{item.uid},#{item.amount},#{item.updateTime},#{item.consumeCount},#{item.orderCount},#{item.phone})
       ON DUPLICATE KEY UPDATE
       `update_time` = VALUES(update_time),
       `phone` = VALUES(phone),
       `amount` = (`amount` + VALUES(amount)),
       `consume_count` = (`consume_count` + VALUES(consume_count)),
       `order_count` = (`order_count` + VALUES(order_count))
   </insert>

    <update id="updateSubBalance">
       update `u_account_balance` set  `amount` = (`amount`- #{item.amount}),`update_time`= #{item.updateTime} where `uid` = #{item.uid} and `amount` >= #{item.amount}
    </update>

</mapper>